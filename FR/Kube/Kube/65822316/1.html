<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>J'ai réparé Kube !</title>
    <link href="../../../../gfx/game/Kube.ico" rel="icon" type="image/gif"/>
    <link href="../../../../css/twinoid_layout.css" rel="stylesheet" type="text/css"/>
    <link href="../../../../css/twinoid_bar.css" rel="stylesheet" type="text/css"/>
    <link href="../../../../css/custom.css" rel="stylesheet" type="text/css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.tid_niceHiddenNotice').click(function() {
                $(this).next('.tid_post').slideDown(500);
                $(this).slideUp(250);
            });
        });
    </script>
</head>
<body>
    <div id="contentBg">
        <div class="tid_forum_init" id="tid_forum">
            <div id="tid_forum_all"></div>
            <table class="tid_forumLayout">
                <tbody>
                    <tr>
                        <td id="tid_forum_right">
                            <div class="tid_containerWrapper">
                                <div class="tid_forumThread">
                                    <div class="tid_mainBar">
                                        <div class="tid_stack tid_bg4">
											<a class="tid_bg4" href="../../../Index.html" tid_href="left:">
												<img src="../../../../gfx/design/flag_FR.svg" style="width: 20px; height: 15px; vertical-align: middle;">
												Accueil
											</a>
                                            <a class="tid_bg4" href="../../Index.html" tid_href="left:">Kube</a>
                                            <a class="tid_bg4" href="../Index.html" tid_href="left:">Kube</a>
                                            <span class="tid_title">J'ai réparé Kube !</span>
                                        </div>
                                        
                                    </div>
                                    <div class="tid_clear tid_threadStart"></div>
                                    <div class="tid_post tid_ tid_read" id="tid_forumPost_0">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_d_7_a2aa3a19_121864_100x100.png" title="TheToto" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 22 juin 2022
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_121864 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/121864/1" tid_id="121864">TheToto</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle"><img alt="[?]" src="..\..\..\..\gfx\icons\rank_furi_12.gif" title=""/> Hero Of The Day</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p><span class="tid_sideNote">Je fait un nouveau sujet pour un peu de visibilité</span></p><br><p><span class="tid_roleplay"><span class="tid_wroleplay">Comment Kube stocke les octoblocks</span></span><br>Comme vous le savez déjà, le monde de kube est découpé en <em>octoblocks</em> de 8x8 zones pour le chargement dans le client.</p><p>Lorsque vous effectuez une modification, pour une question de performance, les modifications sont stockés en mémoire (et pas dans la base de données).</p><p><span class="tid_sideNote">data: [données de l'octoblock, compressés, en base de donnée]<br>patches: [corrections appliqués sur data, non compressés, en RAM]</span></p><p>En temps normal, le serveur rappatrie les <em>patches</em> en base de donnée de temps en temps (quand ? grande question).</p><br><p><span class="tid_roleplay"><span class="tid_wroleplay">Qu'es ce qu'un rollback ?</span></span><br>Un rollback est sans doute la perte de tout les <em>patches</em>. Par exemple, si le serveur redémarre pour n'importe quelle raison, et qu'il n'a pas rapatrié les patches en base de données, ces derniers sont perdus.</p><br><p><span class="tid_roleplay"><span class="tid_wroleplay">Et le double FCHK ?</span></span><br>La communication entre le client et le serveur de Kube sont chiffrés. Un FCHK se produit quand le client n'arrive pas à déchiffrer la réponse du serveur. <em>(cela peut arriver quand vous ouvrez Kube dans 2 onglets différents, la clé de chiffrement a changé, et le premier client ne peut plus déchiffrer les réponses.)</em></p><p>Un double FCHK, c'est donc deux réponses du serveur, qu'il n'a pas réussi a déchiffrer.</p><p><span class="tid_sideNote">Et donc ? <img src="../../../../gfx/square/calim.png" alt=":calim:" class="tid_ico"></span><br>Un double FCHK se produit quand les <em>patches</em> d'un octoblock deviennent tellement gros, que le serveur décide de scinder sa réponse en 2. Le client Kube ne gère pas correctement ce cas, et n'arrive pas a les décoder.</p><p>Pour résumer:<br><img src="../../../../gfx/square/arrow.png" alt=":tid_arrow:" class="tid_ico"> Beaucoup de modifications dans un octoblock fait grossir la taille des réponses du serveur<br><img src="../../../../gfx/square/arrow.png" alt=":tid_arrow:" class="tid_ico"> La procédure de rapatriement en base de donnée (qui permet de purger les <em>patches</em>) semble ne plus fonctionner correctement (aléatoire)<br><img src="../../../../gfx/square/arrow.png" alt=":tid_arrow:" class="tid_ico"> Au bout d'un moment, le serveur découpe sa réponse en 2, ce qui n'est pas géré par le client.</p><br><p>Après quelques modifications, j'ai pu charger les chunks problématique dans ma réimplémentation du client Kube, en concaténant les deux réponses qui ont été scindés (plus d'info chez Eternal Twin <img src="../../../../gfx/square/lookup.png" alt=":tid_innocent:" class="tid_ico">)</p><br><p><span class="tid_roleplay"><span class="tid_wroleplay">Que faire ? <img src="../../../../gfx/square/crylot.png" alt="T_T" class="tid_ico"></span></span><br>Ne pas faire trop de modification d'un coup ? <img src="../../../../gfx/square/calim.png" alt=":calim:" class="tid_ico"> Il y a deux scénarios après un double FCHK :</p><p>1. Le rapatriement en base de donnée finira par s'effectuer, rien ne sera perdu, et tout fonctionnera de nouveau. (peu probable)<br>2. Un rollback va purger les <em>patches</em>. Ces derniers seront perdus.</p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div>
                                    <div id="tid_forumReplyForm" style="display: none"></div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>