<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>[JS] Problème d'adresse</title>
    <link href="../../../../gfx/game/Twinoid.ico" rel="icon" type="image/gif"/>
    <link href="../../../../css/twinoid_layout.css" rel="stylesheet" type="text/css"/>
    <link href="../../../../css/twinoid_bar.css" rel="stylesheet" type="text/css"/>
    <link href="../../../../css/custom.css" rel="stylesheet" type="text/css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.tid_niceHiddenNotice').click(function() {
                $(this).next('.tid_post').slideDown(500);
                $(this).slideUp(250);
            });
        });
    </script>
</head>
<body>
    <div id="contentBg">
        <div class="tid_forum_init" id="tid_forum">
            <div id="tid_forum_all"></div>
            <table class="tid_forumLayout">
                <tbody>
                    <tr>
                        <td id="tid_forum_right">
                            <div class="tid_containerWrapper">
                                <div class="tid_forumThread">
                                    <div class="tid_mainBar">
                                        <div class="tid_stack tid_bg4">
											<a class="tid_bg4" href="../../../Index.html" tid_href="left:">
												<img src="../../../../gfx/design/flag_FR.svg" style="width: 20px; height: 15px; vertical-align: middle;">
												Accueil
											</a>
                                            <a class="tid_bg4" href="../../Index.html" tid_href="left:">Twinoid</a>
                                            <a class="tid_bg4" href="../Index.html" tid_href="left:">Développement</a>
                                            <span class="tid_title">[JS] Problème d'adresse</span>
                                        </div>
                                        
                                    </div>
                                    <div class="tid_clear tid_threadStart"></div>
                                    <div class="tid_post tid_ tid_read" id="tid_forumPost_0">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_0_b_7f1b7b09_498714_100x100.gif" title="Protectator" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 3 décembre 2012
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_498714 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/498714/1" tid_id="498714">Protectator</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle"><img alt="[?]" src="..\..\..\..\gfx\icons\bronze.png" title=""/> Pingouin haute-prÃ©cision</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p>Bonjour,</p><p>je tente de faire un petit userscript qui ferait différents trucs sur plusieurs pages. Et pour çela, j'aimerais récupérer l'adresse de la page actuelle. Je récupère donc l'adresse dans une variable, dans mon cas :</p><p><cite>var adresse = document.location.href;</cite></p><p>Quand je suis sur hordes.fr par exemple, je m'attends donc à récupérer l'adresse qui s'affiche dans mon navigateur. Sauf que, lorsque je tente de print grâce à console.log pour voir ce que ca donne, hé bien... surprise ! Voilà ce que j'obtiens :<br><cite><a href="https://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.facebook.com%2F%23%21%2Fpages%2FHordesfr%2F127527310605769%3Fref%3Dts&amp;layout=standard&amp;show_faces=true&amp;width=400&amp;action=like&amp;font=trebuchet+ms&amp;colorscheme=light&amp;height=80" target="_blank">https://www.facebook.com/plugins/like...</a></cite> (Hum, le forum de Motion Twin semble tronquer l'affichage de l'URL... regardez le lien vers où ca pointe)</p><p>Une explication là-dessus ? :/ C'est pas vraiment normal...</p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div><div class="tid_post tid_ tid_read" id="tid_forumPost_1">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_b_c_e6c282cc_3422361.jpg" title="Tyler_Durden" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 3 décembre 2012
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_3422361 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/3422361/1" tid_id="3422361">Tyler_Durden</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle">Voleur de fichiers</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p>Les pages hordes contiennent un module facebook, sur lequel ton script doit aussi s'exécuter. A mon sens, ton console.log s'exécute lors de l'ajout du module, d'où le problème.</p><p>Quels sont les sites autorisés par ton userscript? Tu le fais tourner sur chrome ou firefox?</p><p>Concernant le forum, je n'ai pas bien compris ta question.</p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div><div class="tid_post tid_ tid_read" id="tid_forumPost_2">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_0_b_7f1b7b09_498714_100x100.gif" title="Protectator" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 3 décembre 2012
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_498714 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/498714/1" tid_id="498714">Protectator</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle"><img alt="[?]" src="..\..\..\..\gfx\icons\bronze.png" title=""/> Pingouin haute-prÃ©cision</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p>Hordes.fr n'est pas le seul site concerné. J'ai ce problème également sur DinoRPG, par exemple. J'autorise pour l'instant tous les sites, et j'ai un array avec des regex de sites sur lesquels je vais faire certains trucs. Ca se limitera normalement pas a motion-twin, pou ca que j'autorise tout par défaut, je vais pas pouvoir changer ca. Et je le fais tourner sur Chrome directement en tant qu'extension (Je ne passe pas par TamperMonkey)</p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div><div class="tid_post tid_ tid_read" id="tid_forumPost_3">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_b_c_e6c282cc_3422361.jpg" title="Tyler_Durden" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 3 décembre 2012
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_3422361 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/3422361/1" tid_id="3422361">Tyler_Durden</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle">Voleur de fichiers</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p>OK.</p><p>J'ai eu le même soucis avec mon script quand j'autorisais tout : plusieurs "instances" de mon script tournaient en parallèle respectivement sur :</p><ul><li>la page principale de hordes</li><li>en double sur le forum (1 instance dans la partie menu, une instance dans le contenu)</li><li>dans le module facebook systématiquement</li></ul><p>Le problème supplémentaire avec le module facebook est que, selon mon IP, facebook ramant, mon script prenait plus de temps à démarrer.</p><p>A priori, ton problème devrait se résoudre en ajoutant un array des pages autorisées d'une part, d'autre part en ajoutant dans l'objet window un flag indiquant que ton script est déjà chargé. Ainsi, au début de l'exécution de ton script, tu tests la présence ou non de ce flag, et t'arrête là s'il y est déjà.</p><br><p>De plus, je tiens à te mettre en garde sur le fonctionnement des pages hordes pour chrome et les extensions. En effet, la page initialement chargée est un layout grossier de hordes. Le contenu est ensuite ajouté à la volée en JS, bien que ceci semble instantané. Chrome exéctue ses extensions après le chargement initial de la page, et donc avant que tout soit présent. Je pense en particulier à jQuery qui n'est pas encore chargé, ou à la majorité des éléments HTML de la page.<br>Je te mets en garde, mais tu n'as peut être aucune dépendance à ces éléments...</p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div><div class="tid_post tid_ tid_read" id="tid_forumPost_4">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_9_f_0ab293c5_285727_100x100.png" title="Exagone313" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 5 décembre 2012
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_285727 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/285727/1" tid_id="285727">Exagone313</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle"><img alt="[?]" src="..\..\..\..\gfx\icons\331_1bb9.png" title=""/> Super chez</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p>Peut être avec :<br><cite>window.top.location.href;</cite></p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div><div class="tid_post tid_ tid_read" id="tid_forumPost_5">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_0_b_7f1b7b09_498714_100x100.gif" title="Protectator" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 7 décembre 2012
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_498714 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/498714/1" tid_id="498714">Protectator</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle"><img alt="[?]" src="..\..\..\..\gfx\icons\bronze.png" title=""/> Pingouin haute-prÃ©cision</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p>Merci pour les conseils Tyler <img src="../../../../gfx/square/smile.png" alt=":)" class="tid_ico"> J'avais en effet Facebook ouvert en même temps et le module qui tournait en plusieurs instances. Je pense prendre la solution de Exagone313... puisqu'elle fonctionne et est plus simple <img src="../../../../gfx/square/smile.png" alt=":)" class="tid_ico"> Je vous tiens au courant de l'avancement du script</p><p>Et oui j'ai remarqué qu'une bonne partie du contenu était chargé dynamiquement, mais j'ai de quoi surmonter ça sans trop de problèmes. Merci à vous deux !</p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div><div class="tid_post tid_ tid_read" id="tid_forumPost_6">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_0_b_7f1b7b09_498714_100x100.gif" title="Protectator" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 10 décembre 2012
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_498714 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/498714/1" tid_id="498714">Protectator</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle"><img alt="[?]" src="..\..\..\..\gfx\icons\bronze.png" title=""/> Pingouin haute-prÃ©cision</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p>En fait... ca fonctionne quand je l'exécute dans la console js après le chargement de la page. Mais pas quand je le mets dans mon userscript <img src="../../../../gfx/square/facepalm.png" alt=":fp:" class="tid_ico"> ... Pourquoi ? ^^' <cite>Uncaught TypeError: Cannot read property 'location' of undefined </cite></p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div><div class="tid_post tid_ tid_read" id="tid_forumPost_7">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_0_b_7f1b7b09_498714_100x100.gif" title="Protectator" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 10 décembre 2012
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_498714 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/498714/1" tid_id="498714">Protectator</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle"><img alt="[?]" src="..\..\..\..\gfx\icons\bronze.png" title=""/> Pingouin haute-prÃ©cision</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p>Et je ne trouve pas comment ajouter un flag à l'objet window... tu entend par là une variable ?</p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div><div class="tid_post tid_ tid_read" id="tid_forumPost_8">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_b_c_e6c282cc_3422361.jpg" title="Tyler_Durden" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 10 décembre 2012
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_3422361 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/3422361/1" tid_id="3422361">Tyler_Durden</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle">Voleur de fichiers</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p>Oui, désolé, j'appelle flag toute variable booléenne servant juste à marquer un fait donné, n'étant pas manipulée en tant que telle.</p><p>L'erreur que tu as t'indique qu'il n'y a, lors de l'exécution via le script, pas encore de window.top, et donc qu'il n'arrive à en récupérer la propriété location.<br>Problème très certainement du au fait que la page n'est pas encore loadé entièrement. Tu devrais essayer de différer légèrement l'exécution de ta fonction. J'ai tenté pas mal de choses à ce sujet personnellement : détecter un élément clef de la page et retarder l'exécution (setTimeout) jusqu'à ce que l'élément soit là, attendre l'évènement onload de la page, ... Ca dépend un peu de ton contexte en soit...</p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div><div class="tid_post tid_ tid_read" id="tid_forumPost_9">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_0_b_7f1b7b09_498714_100x100.gif" title="Protectator" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 10 décembre 2012
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_498714 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/498714/1" tid_id="498714">Protectator</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle"><img alt="[?]" src="..\..\..\..\gfx\icons\bronze.png" title=""/> Pingouin haute-prÃ©cision</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p>Hm oui en effet, c'est bien de là que venait l'erreur <img src="../../../../gfx/square/smile.png" alt=":)" class="tid_ico"> j'ai utilisé jQuery et $(document).ready pour appeler la fonction une fois la page chargée, merci <img src="../../../../gfx/square/wink.png" alt=";)" class="tid_ico"></p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div><div class="tid_post tid_ tid_read" id="tid_forumPost_10">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_0_b_7f1b7b09_498714_100x100.gif" title="Protectator" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 10 décembre 2012
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_498714 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/498714/1" tid_id="498714">Protectator</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle"><img alt="[?]" src="..\..\..\..\gfx\icons\bronze.png" title=""/> Pingouin haute-prÃ©cision</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p>C'est vraiment bizarre. Le code semble s'exécuter deux fois sur la même page, et ne fonctionne qu'une fois sur les deux...</p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div><div class="tid_post tid_ tid_read" id="tid_forumPost_11">
    <div class="tid_header tid_bg1">
        <div class="tid_floatBox">
            <table class="tid_valign" style="width : 80px">
                <tbody>
                    <tr>
                        <td>
                            <div class="tid_twinoidAvatar" style="width:80px; max-height:80px; height:80px;">
                                <img src="..\..\..\..\gfx\avatars\twinoid_b_c_e6c282cc_3422361.jpg" title="Tyler_Durden" style="background-color: ; width: 80px;">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tid_date">
            Le 10 décembre 2012
        </div>
        <div class="tid_name">
            <a class="tid_user tid_user_3422361 tid_userNoBg tid_userFriend tid_parsed" href="//twinoid.com/user/go/3422361/1" tid_id="3422361">Tyler_Durden</a>
        </div>
        <div class="tid_title">
            <span class="tid_userTitle">Voleur de fichiers</span>
        </div>
        <div class="tid_clearRight"></div>
    </div>
    <div class="tid_body tid_bg2">
        <div class="tid_arrow"></div>
        <div class="tid_originContent">
            <div class="tid_editorContent tid_parsed">
                <p>Sur le forum ? Oui, il s'exécute 2 fois, une fois pour le menu, une fois pour le contenu (je crois).<br>C'est là que le "flag" a son intérêt. j'explicite :</p><ul><li>Au début de ton script, tu ajoutes un</li><li><pre>if (!unsafeWindow.monscript_execute) {
 unsafeWindow.monscript_exectue = true;
 main();
}</pre></li><li>Tu remplace "main" par le nom de ta fonction principale, ou bien tu englobes ton script en entier dans une fonction que tu appelles "main".</li></ul><p>Ainsi, à la première exécution, la variable "monscript_execute" n'étant pas déclarée, tu la déclares puis tu exécutes ton script. A la seconde exécution, ton script ne sera pas ré-exécuté car la variable (le flag) a été déclarée.</p>
            </div>
        </div>
        <div class="tid_clear"></div>
    </div>
</div>
                                    <div id="tid_forumReplyForm" style="display: none"></div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>